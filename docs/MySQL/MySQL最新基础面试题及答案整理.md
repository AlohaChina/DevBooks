# MySQL最新基础面试题及答案整理

### 其实，博主还整理了，更多大厂面试题，直接下载吧

### 下载链接：[高清172份，累计 7701 页大厂面试题  PDF](https://github.com/souyunku/DevBooks/blob/master/docs/index.md)



### 1、备份计划，MySQLdump以及xtranbackup的实现原理

**备份计划**

**1、** 视库的大小来定，一般来说 100G 内的库，可以考虑使用 MySQLdump 来做，因为 MySQLdump更加轻巧灵活，备份时间选在业务低峰期，可以每天进行都进行全量备份(MySQLdump 备份出来的文件比较小，压缩之后更小)。

**2、** 100G 以上的库，可以考虑用 xtranbackup 来做，备份速度明显要比 MySQLdump 要快。一般是选择一周一个全备，其余每天进行增量备份，备份时间为业务低峰期。

**备份恢复时间**

**1、** 物理备份恢复快，逻辑备份恢复慢

**2、** 这里跟机器，尤其是硬盘的速率有关系，以下列举几个仅供参考

**3、** 20G的2分钟（MySQLdump）

**4、** 80G的30分钟(MySQLdump)

**5、** 111G的30分钟（MySQLdump)

**6、** 288G的3小时（xtra)

**7、** 3T的4小时（xtra)

**8、** 逻辑导入时间一般是备份时间的5倍以上

**备份恢复失败如何处理**

首先在恢复之前就应该做足准备工作，避免恢复的时候出错。比如说备份之后的有效性检查、权限检查、空间检查等。如果万一报错，再根据报错的提示来进行相应的调整。

**MySQLdump和xtrabackup实现原理**

**MySQLdump**

MySQLdump 属于逻辑备份。加入–single-transaction 选项可以进行一致性备份。后台进程会先设置 session 的事务隔离级别为 RR(SET SESSION TRANSACTION ISOLATION LEVELREPEATABLE READ)，之后显式开启一个事务(START TRANSACTION /*!40100 WITH CONSISTENTSNAPSHOT */)，这样就保证了该事务里读到的数据都是事务事务时候的快照。之后再把表的数据读取出来。如果加上–master-data=1 的话，在刚开始的时候还会加一个数据库的读锁(FLUSH TABLES WITH READ LOCK),等开启事务后，再记录下数据库此时 binlog 的位置(showmaster status)，马上解锁，再读取表的数据。等所有的数据都已经导完，就可以结束事务

**Xtrabackup:**

xtrabackup 属于物理备份，直接拷贝表空间文件，同时不断扫描产生的 redo 日志并保存下来。最后完成 innodb 的备份后，会做一个 flush engine logs 的操作(老版本在有 bug，在5.6 上不做此操作会丢数据)，确保所有的 redo log 都已经落盘(涉及到事务的两阶段提交

- 概念，因为 xtrabackup 并不拷贝 binlog，所以必须保证所有的 redo log 都落盘，否则可能会丢最后一组提交事务的数据)。这个时间点就是 innodb 完成备份的时间点，数据文件虽然不是一致性的，但是有这段时间的 redo 就可以让数据文件达到一致性(恢复的时候做的事情)。然后还需要 flush tables with read lock，把 myisam 等其他引擎的表给备份出来，备份完后解锁。这样就做到了完美的热备。


### 2、MySQL 遇到过死锁问题吗，你是如何解决的？

**我排查死锁的一般步骤是酱紫的：**

**1、** 查看死锁日志show engine innodb status;

**2、** 找出死锁Sql

**3、** 分析sql加锁情况

**4、** 模拟死锁案发

**5、** 分析死锁日志

**6、** 分析死锁结果


### 3、数据库的乐观锁和悲观锁。

**悲观锁：**

悲观锁她专一且缺乏安全感了，她的心只属于当前事务，每时每刻都担心着它心爱的数据可能被别的事务修改，所以一个事务拥有（获得）悲观锁后，其他任何事务都不能对数据进行修改啦，只能等待锁被释放才可以执行。

![](https://user-gold-cdn.xitu.io/2020/5/23/1723d313056fce6a?w=899&h=563&f=png&s=50589#alt=)

**乐观锁：**

乐观锁的“乐观情绪”体现在，它认为数据的变动不会太频繁。因此，它允许多个事务同时对数据进行变动。实现方式：乐观锁一般会使用版本号机制或CAS算法实现。

![](https://user-gold-cdn.xitu.io/2020/5/23/1723e7d3872c9406?w=931&h=657&f=png&s=68807#alt=)


### 4、为什么要使用视图？什么是视图？

**「为什么要使用视图？」**

为了提高复杂SQL语句的复用性和表操作的安全性，MySQL数据库管理系统提供了视图特性。

**「什么是视图？」**

视图是一个虚拟的表，是一个表中的数据经过某种筛选后的显示方式，视图由一个预定义的查询select语句组成。


### 5、创建索引的原则？

**1、** 选择唯一性索引：唯一性索引的值是唯一的。可以更快的通过该索引来确定某条记录。

**2、** 为经常需要排序、分组、以及联合查询的列创建索引。

**3、** 为经常作为查询条件的列创建索引。

**4、** 限制索引的数目：越多的索引越导致表的查询效率变低，因为索引表在每次更新表数据的时候都会重新创建这个表的索引，表的数据越多，索引列越多，那么创建索引的时间消耗就越大。

**5、**  如果索引的值很长，那么查询的速度会受到影响。

**6、** 如果索引字段的值很长，最好使用值得前缀来进行索引。

**7、** 删除不再使用或者很少使用的索引。

**8、** 最左前缀匹配原则，非常重要的原则。

**9、** 尽量选择区分度高的列作为索引.

**10、** 索引列不能参与计算，保持列“干净”:带函数的查询不参与索引。

**11、** 尽量的扩展索引，不要新建索引。


### 6、select for update 含义

select查询语句是不会加锁的，但是select for update除了有查询的作用外，还会加锁呢，而且它是悲观锁哦。至于加了是行锁还是表锁，这就要看是不是用了索引/主键啦。

没用索引/主键的话就是表锁，否则就是是行锁。

**1、** 原子性： 事务作为一个整体被执行，包含在其中的对数据库的操作要么全部被执行，要么都不执行。

**2、** 一致性： 指在事务开始之前和事务结束以后，数据不会被破坏，假如A账户给B账户转10块钱，不管成功与否，A和B的总金额是不变的。

**3、** 隔离性： 多个事务并发访问时，事务之间是相互隔离的，即一个事务不影响其它事务运行效果。简言之，就是事务之间是进水不犯河水的。

**4、** 持久性： 表示事务完成以后，该事务对数据库所作的操作更改，将持久地保存在数据库之中。

**「事务ACID特性的实现思想」**

原子性：是使用 undo log来实现的，如果事务执行过程中出错或者用户执行了rollback，系统通过undo log日志返回事务开始的状态。

持久性：使用 redo log来实现，只要redo log日志持久化了，当系统崩溃，即可通过redo log把数据恢复。

隔离性：通过锁以及MVCC,使事务相互隔离开。

一致性：通过回滚、恢复，以及并发情况下的隔离性，从而实现一致性。


### 7、索引的底层实现原理和优化

B+树，经过优化的B+树

主要是在所有的叶子结点中增加了指向下一个叶子节点的指针，因此InnoDB建议为大部分表使用默认自增的主键作为主索引。


### 8、非聚簇索引一定会回表查询吗？

不一定，这涉及到查询语句所要求的字段是否全部命中了索引，如果全部命中了索引，那么就不必再进行回表查询。

**举个简单的例子**

假设我们在员工表的年龄上建立了索引，那么当进行`select age from employee where age < 20`的查询时，在索引的叶子节点上，已经包含了age信息，不会再次进行回表查询。


### 9、事务特性：

（1）原子性：即不可分割性，事务要么全部被执行，要么就全部不被执行。

（2）一致性或可串性。事务的执行使得数据库从一种正确状态转换成另一种正确状态

（3）隔离性。在事务正确提交之前，不允许把该事务对数据的任何改变提供给任何其他事务，

（4） 持久性。事务正确提交后，其结果将永久保存在数据库中，即使在事务提交后有了其他故障，事务的处理结果也会得到保存。

或者这样理解：

事务就是被绑定在一起作为一个逻辑工作单元的SQL语句分组，如果任何一个语句操作失败那么整个操作就被失败，以后操作就会回滚到操作前状态，或者是上有个节点。为了确保要么执行，要么不执行，就可以使用事务。要将有组语句作为事务考虑，就需要通过ACID测试，即原子性，一致性，隔离性和持久性。


### 10、数据库中的事务是什么?

事务（transaction）是作为一个单元的一组有序的数据库操作。如果组中的所有操作都成功，则认为事务成功，即使只有一个操作失败，事务也不成功。如果所有操作完成，事务则提交，其修改将作用于所有其他数据库进程。如果一个操作失败，则事务将回滚，该事务所有操作的影响都将取消。

**事务特性：**

**1、** 原子性：即不可分割性，事务要么全部被执行，要么就全部不被执行。

**2、** 一致性或可串性。事务的执行使得数据库从一种正确状态转换成另一种正确状态

**3、** 隔离性。在事务正确提交之前，不允许把该事务对数据的任何改变提供给任何其他事务，

**4、** 持久性。事务正确提交后，其结果将永久保存在数据库中，即使在事务提交后有了其他故障，事务的处理结果也会得到保存。

**或者这样理解：**

事务就是被绑定在一起作为一个逻辑工作单元的SQL语句分组，如果任何一个语句操作失败那么整个操作就被失败，以后操作就会回滚到操作前状态，或者是上有个节点。为了确保要么执行，要么不执行，就可以使用事务。要将有组语句作为事务考虑，就需要通过ACID测试，即原子性，一致性，隔离性和持久性。


### 11、500台db，在最快时间之内重启。
### 12、主键、外键和索引的区别？
### 13、索引失效情况？ ==校验SQL语句是否使用了索引方式为：
### 14、SQL注入漏洞产生的原因？如何防止？
### 15、MySQL数据库作发布系统的存储，一天五万条以上的增量，预计运维三年,怎么优化？
### 16、如何显示前50行？
### 17、什么是触发器？触发器的使用场景有哪些？
### 18、试述视图的优点？
### 19、数据库存储日期格式时，如何考虑时区转换问题？
### 20、什么是非标准字符串类型？
### 21、索引哪些情况会失效
### 22、MySQL中 in 和 exists 区别
### 23、主键和候选键有什么区别？
### 24、MyISAM表格将在哪里存储，并且还提供其存储格式？
### 25、MySQL中int(10)和char(10)以及varchar(10)的区别
### 26、MySQL存储引擎MyISAM与InnoDB区别
### 27、优化关联查询
### 28、从锁的类别上分MySQL都有哪些锁呢？
### 29、limit 1000000 加载很慢的话，你是怎么解决的呢？




## 全部答案，整理好了，直接下载吧

### 下载链接：[全部答案，整理好了](https://www.souyunku.com/wp-content/uploads/weixin/githup-weixin-2.png)




## 最新，高清PDF：172份，7701页，最新整理

[![大厂面试题](https://www.souyunku.com/wp-content/uploads/weixin/mst.png "架构师专栏")](https://www.souyunku.com/wp-content/uploads/weixin/githup-weixin.png "架构师专栏")

[![大厂面试题](https://www.souyunku.com/wp-content/uploads/weixin/githup-weixin.png "架构师专栏")](https://www.souyunku.com/wp-content/uploads/weixin/githup-weixin.png "架构师专栏")
