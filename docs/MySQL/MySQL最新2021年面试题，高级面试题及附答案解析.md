# MySQL最新2021年面试题，高级面试题及附答案解析

### 其实，博主还整理了，更多大厂面试题，直接下载吧

### 下载链接：[高清172份，累计 7701 页大厂面试题  PDF](https://github.com/souyunku/DevBooks/blob/master/docs/index.md)



### 1、如何优化长难的查询语句

**1、** 分析是一个复杂查询还是多个简单查询速度快

**2、** MySQL内部每秒能扫描内存中上百万行数据，相比之下，响应数据给客户端就要慢得多

**3、** 使用尽可能小的查询是好的，但是有时将一个大的查询分解为多个小的查询是很有必要的。

**4、** 将一个大的查询分为多个小的相同的查询

**5、** 一次性删除1000万的数据要比一次删除1万，暂停一会的方案更加损耗服务器开销。

**6、** 分解关联查询，让缓存的效率更高。

**7、** 执行单个查询可以减少锁的竞争。

**8、** 在应用层做关联更容易对数据库进行拆分。

**9、** 查询效率会有大幅提升。

**10、** 较少冗余记录的查询。


### 2、为表中得字段选择合适得数据类型

字段类型优先级: 整形>date,time>enum,char>varchar>blob,text

优先考虑数字类型，其次是日期或者二进制类型，最后是字符串类型，同级别得数据类型，应该优先选择占用空间小的数据类型



### 3、优化数据库的方法

**1、**  选取最适用的字段属性，尽可能减少定义字段宽度，尽量把字段设置NOTNULL，例如’省份’、’性别’最好适用ENUM

**2、**  使用连接(JOIN)来代替子查询

**3、**  适用联合(UNION)来代替手动创建的临时表

**4、**  事务处理

**5、**  锁定表、优化事务处理

**6、**  适用外键，优化锁定表

**7、**  建立索引

**8、**  优化查询语句


### 4、数据库结构优化

**1、** 一个好的数据库设计方案对于数据库的性能往往会起到事半功倍的效果。

**2、** 需要考虑数据冗余、查询和更新的速度、字段的数据类型是否合理等多方面的内容。

**将字段很多的表分解成多个表**

**1、** 对于字段较多的表，如果有些字段的使用频率很低，可以将这些字段分离出来形成新表。

**2、** 因为当一个表的数据量很大时，会由于使用频率低的字段的存在而变慢。

**增加中间表**

**1、** 对于需要经常联合查询的表，可以建立中间表以提高查询效率。

**2、** 通过建立中间表，将需要通过联合查询的数据插入到中间表中，然后将原来的联合查询改为对中间表的查询。

**增加冗余字段**

设计数据表时应尽量遵循范式理论的规约，尽可能的减少冗余字段，让数据库设计看起来精致、优雅。但是，合理的加入冗余字段可以提高查询速度。

表的规范化程度越高，表和表之间的关系越多，需要连接查询的情况也就越多，性能也就越差。

**注意：**

`冗余字段的值在一个表中修改了，就要想办法在其他表中更新，否则就会导致数据不一致的问题。`


### 5、大表怎么优化？分库分表了是怎么做的？分表分库了有什么问题？有用到中间件么？他们的原理知道么？

当MySQL单表记录数过大时，数据库的CRUD性能会明显下降，一些常见的优化措施如下：

**1、** 限定数据的范围： 务必禁止不带任何限制数据范围条件的查询语句。比如：我们当用户在查询订单历史的时候，我们可以控制在一个月的范围内。；

**2、** 读/写分离： 经典的数据库拆分方案，主库负责写，从库负责读；

**3、** 缓存： 使用MySQL的缓存，另外对重量级、更新少的数据可以考虑使用应用级别的缓存；

**还有就是通过分库分表的方式进行优化，主要有垂直分区、垂直分表和水平分区、水平分表**

**垂直分区**

**1、** 根据数据库里面数据表的相关性进行拆分。 例如，用户表中既有用户的登录信息又有用户的基本信息，可以将用户表拆分成两个单独的表，甚至放到单独的库做分库。

**2、** 简单来说垂直拆分是指数据表列的拆分，把一张列比较多的表拆分为多张表。 如下图所示，这样来说大家应该就更容易理解了。

![](https://gitee.com/souyunkutech/souyunku-home/raw/master/images/souyunku-web/2020/5/2/049/50/99_9.png#alt=99%5C_9.png)

**垂直拆分的优点：**

可以使得行数据变小，在查询时减少读取的Block数，减少I/O次数。此外，垂直分区可以简化表的结构，易于维护。

**垂直拆分的缺点：**

主键会出现冗余，需要管理冗余列，并会引起Join操作，可以通过在应用层进行Join来解决。此外，垂直分区会让事务变得更加复杂；

**垂直分表**

把主键和一些列放在一个表，然后把主键和另外的列放在另一个表中

![](https://gitee.com/souyunkutech/souyunku-home/raw/master/images/souyunku-web/2020/5/2/049/50/99_10.png#alt=99%5C_10.png)

**适用场景**

**1、** 如果一个表中某些列常用，另外一些列不常用

**2、** 可以使数据行变小，一个数据页能存储更多数据，查询时减少I/O次数

**缺点**

**1、** 有些分表的策略基于应用层的逻辑算法，一旦逻辑算法改变，整个分表逻辑都会改变，扩展性较差

**2、** 对于应用层来说，逻辑算法增加开发成本

**3、** 管理冗余列，查询所有数据需要join操作

**水平分区**

**1、** 保持数据表结构不变，通过某种策略存储数据分片。这样每一片数据分散到不同的表或者库中，达到了分布式的目的。 水平拆分可以支撑非常大的数据量。

**2、** 水平拆分是指数据表行的拆分，表的行数超过200万行时，就会变慢，这时可以把一张的表的数据拆成多张表来存放。举个例子：我们可以将用户信息表拆分成多个用户信息表，这样就可以避免单一表数据量过大对性能造成影响。

![](https://gitee.com/souyunkutech/souyunku-home/raw/master/images/souyunku-web/2020/5/2/049/50/99_11.png#alt=99%5C_11.png)

**1、** 水品拆分可以支持非常大的数据量。需要注意的一点是:分表仅仅是解决了单一表数据过大的问题，但由于表的数据还是在同一台机器上，其实对于提升MySQL并发能力没有什么意义，所以 **水平拆分最好分库** 。

**2、** 水平拆分能够支持非常大的数据量存储，应用端改造也少，但 **分片事务难以解决** ，跨界点Join性能较差，逻辑复杂。

《Java工程师修炼之道》的作者推荐 尽量不要对数据进行分片，因为拆分会带来逻辑、部署、运维的各种复杂度 ，一般的数据表在优化得当的情况下支撑千万以下的数据量是没有太大问题的。如果实在要分片，尽量选择客户端分片架构，这样可以减少一次和中间件的网络I/O。

**水平分表：**

表很大，分割后可以降低在查询时需要读的数据和索引的页数，同时也降低了索引的层数，提高查询次数

![](https://gitee.com/souyunkutech/souyunku-home/raw/master/images/souyunku-web/2020/5/2/049/50/99_12.png#alt=99%5C_12.png)

**适用场景**

**1、** 表中的数据本身就有独立性，例如表中分表记录各个地区的数据或者不同时期的数据，特别是有些数据常用，有些不常用。

**2、** 需要把数据存放在多个介质上。

**水平切分的缺点**

**1、** 给应用增加复杂度，通常查询时需要多个表名，查询所有数据都需UNION操作

**2、** 在许多数据库应用中，这种复杂度会超过它带来的优点，查询时会增加读一个索引层的磁盘次数

**数据库分片的两种常见方案：**

**客户端代理：**

分片逻辑在应用端，封装在jar包中，通过修改或者封装JDBC层来实现。当当网的 **Sharding-JDBC** 、阿里的TDDL是两种比较常用的实现。

**中间件代理：**

在应用和数据中间加了一个代理层。分片逻辑统一维护在中间件服务中。** 我们现在谈的 Mycat** 、360的Atlas、网易的DDB等等都是这种架构的实现。

**分库分表后面临的问题**

**事务支持**

分库分表后，就成了分布式事务了。如果依赖数据库本身的分布式事务管理功能去执行事务，将付出高昂的性能代价； 如果由应用程序去协助控制，形成程序逻辑上的事务，又会造成编程方面的负担。

**跨库join**

只要是进行切分，跨节点Join的问题是不可避免的。但是良好的设计和切分却可以减少此类情况的发生。解决这一问题的普遍做法是分两次查询实现。在第一次查询的结果集中找出关联数据的id,根据这些id发起第二次请求得到关联数据。 分库分表方案产品

**跨节点的count,order by,group by以及聚合函数问题**

这些是一类问题，因为它们都需要基于全部数据集合进行计算。多数的代理都不会自动处理合并工作。解决方案：与解决跨节点join问题的类似，分别在各个节点上得到结果后在应用程序端进行合并。和join不同的是每个结点的查询可以并行执行，因此很多时候它的速度要比单一大表快很多。但如果结果集很大，对应用程序内存的消耗是一个问题。

**数据迁移，容量规划，扩容等问题**

来自淘宝综合业务平台团队，它利用对2的倍数取余具有向前兼容的特性（如对4取余得1的数对2取余也是1）来分配数据，避免了行级别的数据迁移，但是依然需要进行表级别的迁移，同时对扩容规模和分表数量都有限制。总得来说，这些方案都不是十分的理想，多多少少都存在一些缺点，这也从一个侧面反映出了Sharding扩容的难度。

**ID问题**

一旦数据库被切分到多个物理结点上，我们将不能再依赖数据库自身的主键生成机制。一方面，某个分区数据库自生成的ID无法保证在全局上是唯一的；另一方面，应用程序在插入数据之前需要先获得ID,以便进行SQL路由、一些常见的主键生成策略

UUID 使用UUID作主键是最简单的方案，但是缺点也是非常明显的。由于UUID非常的长，除占用大量存储空间外，最主要的问题是在索引上，在建立索引和基于索引进行查询时都存在性能问题。 **Twitter的分布式自增ID算法Snowflake** 在分布式系统中，需要生成全局UID的场合还是比较多的，twitter的snowflake解决了这种需求，实现也还是很简单的，除去配置信息，核心代码就是毫秒级时间41位 机器ID 10位 毫秒内序列12位。

**跨分片的排序分页问题**

一般来讲，分页时需要按照指定字段进行排序。当排序字段就是分片字段的时候，我们通过分片规则可以比较容易定位到指定的分片，而当排序字段非分片字段的时候，情况就会变得比较复杂了。为了最终结果的准确性，我们需要在不同的分片节点中将数据进行排序并返回，并将不同分片返回的结果集进行汇总和再次排序，最后再返回给用户。如下图所示：

![](https://gitee.com/souyunkutech/souyunku-home/raw/master/images/souyunku-web/2020/5/2/049/50/99_13.png#alt=99%5C_13.png)


### 6、B+树在满足聚簇索引和覆盖索引的时候不需要回表查询数据，

在B+树的索引中，叶子节点可能存储了当前的key值，也可能存储了当前的key值以及整行的数据，这就是聚簇索引和非聚簇索引。 在InnoDB中，只有主键索引是聚簇索引，如果没有主键，则挑选一个唯一键建立聚簇索引。如果没有唯一键，则隐式的生成一个键来建立聚簇索引。

`当查询使用聚簇索引时，在对应的叶子节点，可以获取到整行数据，因此不用再次进行回表查询。`


### 7、如何在Unix和MySQL时间戳之间进行转换？

UNIX_TIMESTAMP是从MySQL时间戳转换为Unix时间戳的命令

FROM_UNIXTIME是从Unix时间戳转换为MySQL时间戳的命令


### 8、索引能干什么?

索引非常关键，尤其是当表中的数据量越来越大时，索引对于性能的影响愈发重要。 索引能够轻易将查询性能提高好几个数量级，总的来说就是可以明显的提高查询效率。


### 9、关心过业务系统里面的sql耗时吗？统计过慢查询吗？对慢查询都怎么优化过？

**1、** 我们平时写Sql时，都要养成用explain分析的习惯。

**2、** 慢查询的统计，运维会定期统计给我们

**优化慢查询：**

**1、** 分析语句，是否加载了不必要的字段/数据。

**2、** 分析SQl执行句话，是否命中索引等。

**3、** 如果SQL很复杂，优化SQL结构

**4、** 如果表数据量太大，考虑分表


### 10、什么是存储过程？有哪些优缺点？

「存储过程」，就是一些编译好了的SQL语句，这些SQL语句代码像一个方法一样实现一些功能（对单表或多表的增删改查），然后给这些代码块取一个名字，在用到这个功能的时候调用即可。

**「优点：」**

**1、** 存储过程是一个预编译的代码块，执行效率比较高

**2、** 存储过程在服务器端运行，减少客户端的压力

**3、** 允许模块化程序设计，只需要创建一次过程，以后在程序中就可以调用该过程任意次，类似方法的复用

**4、** 一个存储过程替代大量T_SQL语句 ，可以降低网络通信量，提高通信速率

**5、** 可以一定程度上确保数据安全

**「缺点：」**

**1、** 调试麻烦

**2、** 可移植性不灵活

**3、** 重新编译问题



### 11、Innodb的事务实现原理？
### 12、谈谈MySQL的Explain
### 13、MYSQL数据库服务器性能分析的方法命令有哪些?
### 14、什么是最左前缀原则？什么是最左匹配原则？
### 15、索引的一些潜规则
### 16、创建索引有什么原则呢？
### 17、说说MySQL 的基础架构图
### 18、MVCC熟悉吗，它的底层原理？
### 19、NULL是什么意思
### 20、完整性约束包括哪些？
### 21、你怎么知道SQL语句性能是高还是低
### 22、索引有哪些优缺点？
### 23、怎样才能找出最后一次插入时分配了哪个自动增量？
### 24、drop、delete与truncate的区别
### 25、按照锁的粒度分，数据库锁有哪些呢？锁机制与InnoDB锁算法
### 26、什么是索引？
### 27、主从同步延迟的原因
### 28、MyISAM索引与InnoDB索引的区别？
### 29、一个6亿的表a，一个3亿的表b，通过外间tid关联，你如何最快的查询出满足条件的第50000到第50200中的这200条数据记录。
### 30、B树和B+树的区别




## 全部答案，整理好了，直接下载吧

### 下载链接：[全部答案，整理好了](https://www.souyunku.com/wp-content/uploads/weixin/githup-weixin-2.png)




## 最新，高清PDF：172份，7701页，最新整理

[![大厂面试题](https://www.souyunku.com/wp-content/uploads/weixin/mst.png "架构师专栏")](https://www.souyunku.com/wp-content/uploads/weixin/githup-weixin.png "架构师专栏")

[![大厂面试题](https://www.souyunku.com/wp-content/uploads/weixin/githup-weixin.png "架构师专栏")](https://www.souyunku.com/wp-content/uploads/weixin/githup-weixin.png "架构师专栏")
